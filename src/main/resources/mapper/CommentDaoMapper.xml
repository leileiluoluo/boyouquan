<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.boyouquan.dao.CommentDaoMapper">
    <sql id="insert_columns">
        id,
        url,
        nick,
        mail,
        link,
        href,
        comment,
        ua,
        rid,
        pid,
        ruser,
        created,
        updated,
        deleted
    </sql>
    <sql id="select_columns">
        id,
        nick,
        mail,
        link,
        href,
        comment,
        ua,
        rid,
        pid,
        ruser,
        UNIX_TIMESTAMP(created)*1000 as created,
        UNIX_TIMESTAMP(updated)*1000 as updated
    </sql>
    <select id="countByUrl" resultType="java.lang.Long">
        SELECT
        COUNT(1)
        FROM comment
        WHERE deleted=false
        AND url=#{url}
    </select>
    <select id="listByUrl" resultType="com.boyouquan.model.Comment">
        SELECT
        <include refid="select_columns"/>
        FROM comment
        WHERE deleted=false
        AND url=#{url}
        ORDER BY created DESC
    </select>
    <select id="listRepliesById" resultType="com.boyouquan.model.Comment">
        SELECT
        <include refid="select_columns"/>
        FROM comment
        WHERE deleted=false
        AND rid=#{id}
        ORDER BY created DESC
    </select>
    <insert id="save">
        INSERT INTO comment (
        <include refid="insert_columns"/>
        ) VALUES (
        #{id},
        #{url},
        #{nick},
        #{mail},
        #{link},
        #{href},
        #{comment},
        #{ua},
        #{rid},
        #{pid},
        #{ruser},
        now(),
        now(),
        false
        )
    </insert>
</mapper>